<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Servicios</title>

    <!-- color de barra de direcciones -->
    <meta name="theme-color" content="#ff4500">
    <!-- navegador movil, sitio optimizado para movil y amistoso -->
    <meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">

    <!-- apple -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- icono de la pagina -->
    <link rel="shortcut icon" type="image/png" href="./img/campana.png">

    <!-- icono de aplicacion en los dispositivos -->
    <link rel="apple-touch-icon" href="./img/campana.png">
    <!-- imagen de carga movil -->
    <link rel="apple-touch-startup-image" href="./img/campana.png">
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="./style.css">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
      
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Jaldi&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-wrapper">
            <!-- <p class="title">BIENVENIDO</p> -->
            <ul id="nav-mobile" class="right">
            </ul>
        </div>
    </nav>

    <section>
        <div class="input-field col s6">
            <input id="url" type="text">
            <label for="url">Url de youtube</label>
        </div>
    </section>
    <section>
        <iframe id="iframe" width="100%" height="400rem" src="https://www.youtube.com/embed/WopbUeiJrdM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </section>
    <script src="./script.js"></script>
</body>
<script>
    $("#url").on("change",()=>
    {
        var url = $("#url").val();
        var urlTemp = "";
        var urlF = "";
        if(url.includes("watch"))
        {
            urlTemp = url.split("list=");
        }
        else
        {
            urlTemp = url.split("/");
        }

        $.each(urlTemp,function(index,value)
        {
            urlF = value;
        });

        if(url.includes("watch"))
        {
            $("#iframe").attr("src","https://www.youtube.com/embed/videoseries?list=" + urlF);
            // $("#iframe").attr("src",url);
        }
        else
        {
            $("#iframe").attr("src","https://www.youtube.com/embed/" + urlF);
        }
        
    });

    var deferredPrompt;
    var btn_install;

// window.onload = function()

// function installPWA()
// $("#btn_install").on("click",()=>{

// {
// btnSave.addEventListener('click', function()
function eventInstall()
{
    if(deferredPrompt !== undefined)
    {
        // The user has had a positive interaction with our app and Chrome
        // has tried to prompt previously, so let's show the prompt.
        deferredPrompt.prompt();

        // Follow what the user has done with the prompt.
        deferredPrompt.userChoice.then(function(choiceResult) {

        console.log(choiceResult.outcome);

        if(choiceResult.outcome == 'dismissed') {
            console.log('User cancelled home screen install');
        }
        else {
            console.log('User added to home screen');
        }

        // We no longer need the prompt.  Clear it up.
        deferredPrompt = null;
        });
    }
}
// });
window.addEventListener('beforeinstallprompt', function(e)
{
    
    console.log('beforeinstallprompt Event fired');
    e.preventDefault();
    // Stash the event so it can be triggered later.
    deferredPrompt = e;
    if(btn_install==undefined)
    {
        btn_install = $("<a>");
        $(btn_install).append("<i class='material-icons'>file_download</i>");
        $(btn_install).on("click",()=>{eventInstall()});
        $("#nav-mobile").append(btn_install);
    }

    //   $("#nav-mobile").append("<li><a id='btn_install'><i class='material-icons'>file_download</i></a></li>");

  return false;
});
</script>
</html>